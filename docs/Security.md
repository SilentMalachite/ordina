# セキュリティガイド

本ドキュメントは、Ordina の推奨セキュリティ設定と設計上の注意点をまとめたものです。

## バックアップの安全性

- `.env` はバックアップに含めません（機密情報の漏洩防止）。
- バックアップのダウンロード/削除は以下の対策を実装済みです。
  - ファイル名のバリデーション（英数・ドット・ハイフン・アンダースコアのみ）
  - 許可拡張子の制限（ZIP/JSON）
  - 実パスがバックアップディレクトリ配下にあるか検証

## ログの安全性

- ログファイルへの操作（閲覧/クリア/削除/ローテーション）もファイル名検証と実パス検証を通過した場合のみ実行されます。
- ログローテーションの上限数/サイズは `config/ordina.php`（ENV: `ORDINA_MAX_LOG_FILES`, `ORDINA_MAX_LOG_SIZE`）で調整可能です。

## デバッグ設定

- `.env.example` の既定は `APP_DEBUG=false`。本番環境では必ず無効化してください。

## APIトークン

- 推奨ヘッダー: `Authorization: Bearer <token>`
- 互換目的でクエリ/フォームからの受け取りを許容していますが、将来のバージョンで廃止予定です。
- レート制限ヘッダー `X-RateLimit-Type`, `X-RateLimit-Remaining` を返却します。`429` の場合は `Retry-After` を参照してください。

## 推奨運用

- 権限とロールは Seeder または専用コマンドで初期化し、ユーザーにはロール割り当てを基本とする。
- バックアップファイルは安全な場所に退避し、不要なバックアップは削除する（上限超過時は自動クリーンアップも実行可能）。
- 機密情報（APIキー・DB資格情報）は `.env` で管理し、バックアップ・ログに出力しない。

